#include "Coffee_bean.h"

void 	Thin_step1(uint8 IMG[ROW][COL])
{
	uint16 		i, j;
    uint16 		ii, jj;
	uint8 		P,P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12,P13,P14,P15;
	uint8 		Px, Px1, Px2, Px3, Px4, Px5, Px6;
	uint8	 	Py, Py1, Py2, Py3;
	uint8		check;
	uint8 		M[ROW][COL];

	for (i = 0; i < ROW; i++)
	{
		for (j = 0; j < COL; j++)
		{
			M[i][j] = 0;
		}
	}
	do
	{
		//====================================================================================//
		check = 1;
		for (i = 2; i < (ROW - 2); i++)
		{
			for (j = 2; j < (COL - 2); j++)
			{
				//====================================================================================//
				P = IMG[i][j];
				//====================================================================================//
				if (P == 0)   continue;
				else
				{
					P1 = IMG[i - 1][j - 1];   P2 = IMG[i - 1][j];   P3 = IMG[i - 1][j + 1];
					P4 = IMG[i][j + 1];   P5 = IMG[i + 1][j + 1];   P6 = IMG[i + 1][j];
					P7 = IMG[i + 1][j - 1];   P8 = IMG[i][j - 1];   P9 = IMG[i - 2][j - 2];
					P10 = IMG[i - 2][j - 1];   P11 = IMG[i - 2][j];   P12 = IMG[i - 2][j + 1];
					P13 = IMG[i + 1][j - 2];   P14 = IMG[i][j - 2];   P15 = IMG[i - 1][j - 2];
					//------------------------------------------------------------------------------//
					Px1 = (~P4) & P8 & ((P1&P2 & (~P5) & (~P6)) | ((~P2) & (~P3) & P6&P7));
					Px2 = P6&P7&P8 & ((P1&P2 & (~P4)) | ((~P2) & P4&P5));
					Px3 = (~P2) & (~P3) & (~P4) & ((((~P5) & (~P6) & P8) & (P1 | P7)) | (((~P1) & P6 & (~P8)) & (P7 | P5)));
					Px4 = P4 & (~P8) & (((~P1) & (~P2) & P6) | (P2 & (~P6) & (~P7)));
					Px5 = P2&P3&P4 & ((P5&P6 & (~P8)) | (P1 & (~P6) & P8));
					Px6 = (~P6) & (~P7) & (~P8) & ((((~P1) & (~P2) & P4) & (P5 | P3)) | ((P2 & (~P4) & (~P5)) & (P3 | P1)));

					Px = Px1 | Px2 | Px3 | Px4 | Px5 | Px6;
					//-------------------------------------------------------------------------------//
					Py1 = P1 & P2 & P6 & P7 & P8 & (~P4) & (~P14);
					Py2 = P1 & P2 & P3 & P4 & (~P6) & P8 & (~P11);
					Py3 = P1 & P2 & (~P3) & (~P4) & (~P5) & (~P6) & (~P7) & P8 & (~P9) & (~P10) & (~P11) & (~P12) & (~P13) & (~P14) & (~P15);

					Py = Py1 | Py2 | Py3;
					//-------------------------------------------------------------------------------//
					if ((Px == 1) & (Py != 1))
					{
						M[i][j] = 0;
						check = 0;
					}
					else M[i][j] = 1;
				}
				//====================================================================================//
			}
		}
		if (check == 0)
		{
			for (ii = 0; ii < (ROW ); ii++)
			{
				for (jj = 0; jj < (COL); jj++)
				{
					IMG[ii][jj] *= M[ii][jj];
				}
			}
		}

	} while (check == 0);

}
